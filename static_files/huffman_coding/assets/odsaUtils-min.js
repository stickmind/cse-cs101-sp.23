"use strict";var PARAMS={};(function($){var settings;var moduleName;var chapterName;var moduleSections;var exerciseName;var uiid=+new Date;var langDict={};JSAV._types.ds.AVArray.prototype.slice=function(start,end){var array=[];for(var i=0;i<end-start;i++){array[i]=this.value(start+i)}return array};JSAV._types.ds.AVArray.prototype.highlightBlue=function(index){return this.addClass(index,"processing")};JSAV._types.ds.AVArray.prototype.unhighlightBlue=function(index){return this.removeClass(index,"processing")};JSAV._types.ds.AVArray.prototype.markSorted=function(index){this.removeClass(index,"processing");return this.addClass(index,"sorted")};JSAV._types.ds.AVArray.prototype.toString=function(){var size=this.size();var str="[";for(var i=0;i<size;i++){str+=this.value(i);if(i<size-1){str+=", "}}str+="]";return str};function setJSAVOpt(key,value){if(key.indexOf("JXOP-")===0){JSAV_EXERCISE_OPTIONS[key.replace("JXOP-","")]=value}else if(key.indexOf("JOP-")===0){JSAV_OPTIONS[key.replace("JOP-","")]=value}}function parseURLParams(){var query_params=JSAV.utils.getQueryParameter();for(var key in query_params){if(query_params.hasOwnProperty(key)){setJSAVOpt(key,query_params[key])}}PARAMS=query_params}function loadLangMod(){var langText={};var url="_static/language_msg.json";if(loggingServerEnabled()){if(hasBook()){url="/OpenDSA/Books/"+ODSA.SETTINGS.BOOK_NAME+"/html/_static/language_msg.json"}else{url="/OpenDSA/tools/language_msg.json"}}$.ajax({url:url,async:false,dataType:"json",success:function(data){var langFile=getJSON(data);var tmpLD=langFile[ODSA.SETTINGS.BOOK_LANG].jinja;var tmpLD1=langFile[ODSA.SETTINGS.BOOK_LANG].js;langText=$.extend({},tmpLD,tmpLD1)},error:function(data){data=getJSON(data);if(data.hasOwnProperty("status")&&data.status===200){console.error("JSON language file is malformed. Please make sure your JSON is valid.")}else{console.error("Unable to load JSON language file ("+url+")")}}});return langText}function getType(obj){if(typeof obj!=="undefined"){return Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()}return"undefined"}function hasToolProvider(){return typeof ODSA.TP!=="undefined"}function hasBook(){return typeof ODSA.TP.instBookId!=="undefined"}function isFullModule(){return typeof ODSA.TP.instChapterModuleId!=="undefined"}function isStandaloneModule(){return typeof ODSA.TP.instModuleVersionId!=="undefined"}function getBookURL(){if(typeof ODSA.SETTINGS.BOOK_URL==="undefined"){var loc=location.href;ODSA.SETTINGS.BOOK_URL=loc.substring(0,loc.lastIndexOf("/")+1)}return ODSA.SETTINGS.BOOK_URL}function getBookID(){return ODSA.hasOwnProperty("TP")&&ODSA.TP.hasOwnProperty("instBookId")?ODSA.TP.instBookId:null}function getSectionID(){return ODSA.TP.instSectionId}function getChapterModuleID(){return ODSA.TP.instChapterModuleId}function getModuleID(){return ODSA.TP.instModuleId}function getChapterID(){return ODSA.hasOwnProperty("TP")&&ODSA.TP.hasOwnProperty("instChapterId")?ODSA.TP.instChapterId:null}function getInstModuleVersionId(){return ODSA.TP.instModuleVersionId}function getExerciseSettings(shortName){return ODSA.TP.exerciseSettings[shortName]}function getInstCourseOfferingExerciseId(){return ODSA.TP.instCourseOfferingExerciseId}function loggingServerEnabled(){return!!ODSA.TP}function scoringServerEnabled(){return!!ODSA.TP}function getUserEmail(){return ODSA.TP.userEmail}function roundPercent(number){return Math.round(number*100)/100}function isJSAVControl(item){return item&&item.parentElement&&item.parentElement.className.match(/.*jsav\w*control.*/)!==null}function getJSON(data){if(typeof data==="undefined"){console.warn("getJSON() error: data is undefined");return{}}if(getType(data)==="string"){try{data=jQuery.parseJSON(data)}catch(e){return null}}return data}function permute(arr){for(var i=0;i<arr.length;i++){var randompos=Math.floor(Math.random()*arr.length);var temp=arr[i];arr[i]=arr[randompos];arr[randompos]=temp}}function handleMsg(message,lineNum,fileName,className,element){var newmessage=message.join(",");var re="Try Again";newmessage=newmessage.replace(/\n/gi,"");if(newmessage.indexOf(re)==-1){var re=new RegExp(fileName,"g");newmessage=newmessage.replace(re,"Error:line# ");newmessage=newmessage.replace(className,"");newmessage=newmessage.replace(/\^/gi,"");var numbers=newmessage.match(/\d+\.?\d*/g);for(var i=numbers.length-2;i>=0;i--){var newnumber=numbers[i]-lineNum;var stringnum=numbers[i]+"";var newstringnumber=newnumber+"";newmessage=newmessage.replace(stringnum,newstringnumber)}}var msg=newmessage.split(",");$("#"+element).empty();for(var i=0;i<msg.length;i++){var msgLine=$("<div>"+msg[i]+"</div>");$("#"+element).append(msgLine)}}function loadConfig(args){if(typeof args==="undefined"){args={}}var av_name=args.hasOwnProperty("av_name")?args.av_name:settings.AV_NAME;var json_url=av_name;if(args.hasOwnProperty("json_path")){if(loggingServerEnabled()){var fixed=args.json_path.replace(/\.\.\//g,"");fixed=fixed.indexOf("/")===0?fixed:"/"+fixed;json_url="/OpenDSA"+fixed}else{json_url=args.json_path}}var av_container=$("#container");var configurationFile;var result={interpreter:function(tag){return tag},code:undefined,getSettings:function(){return new JSAV.utils.Settings($(".jsavsettings"))},params:{}};if(args.hasOwnProperty("av_container")&&$("#"+args.av_container).length>0){av_container=$("#"+args.av_container)}else if($("#"+av_name).length>0){if(!args.hasOwnProperty("json_path")){json_url=$('script[src*="/'+av_name+'.js"]')[0].src+"on"}av_container=$("#"+av_name)}else if($(av_container).length===0){console.warn("ERROR: Unable to apply translation because #"+av_container+", #"+av_name+", and #container do not exist")}if(json_url.indexOf(".json")===-1){json_url+=".json"}var lang=(JSAV_EXERCISE_OPTIONS.lang||JSAV_OPTIONS.lang||"en").toLowerCase();var code_lang=(JSAV_EXERCISE_OPTIONS.code||JSAV_OPTIONS.code||args.default_code||"").toLowerCase();var langs=[],code_langs=[];$.ajax({url:json_url,async:false,dataType:"json",success:function(data){configurationFile=ODSA.UTILS.getJSON(data);var langUrl="";if(typeof configurationFile!=="undefined"&&configurationFile.hasOwnProperty("translations")){var translation;if(typeof configurationFile.translations==="string"){langUrl=configurationFile.translations.replace("{lang}",lang)}else{langs=Object.keys(configurationFile.translations);if(!configurationFile.translations.hasOwnProperty(lang)){console.warn("Desired language ("+lang+") does not exist, falling back to English");lang="en"}if(typeof configurationFile.translations[lang]==="object"){translation=configurationFile.translations[lang]}else if(typeof configurationFile.translations[lang]==="string"){langUrl=json_url.split("/");langUrl.pop();langUrl=langUrl.join("/");if(langUrl!==""){langUrl+="/"}langUrl+=configurationFile.translations[lang]}}if(langUrl!==""){var langData;$.ajax({url:langUrl,async:false,dataType:"json",success:function(data){langData=data}});translation=langData}result.interpreter=JSAV.utils.getInterpreter(translation);if(typeof translation==="undefined"){console.error("There is no translation support for language "+JSAV_OPTIONS.lang)}else{var elem;for(var field in translation){if(translation.hasOwnProperty(field)&&field.indexOf("av_")!==0){elem=av_container.find(field);if(elem.size()>0){if(elem.is("input")){elem.attr("value",translation[field])}else{elem.html(translation[field])}}}}}}else{console.error('JSON language file does not contain a "translations" key.  Please make sure your JSON file follows the correct format.')}if(configurationFile&&configurationFile.code){code_langs=["none"].concat(Object.keys(configurationFile.code))}if(code_lang!=="none"&&typeof configurationFile!=="undefined"&&configurationFile.hasOwnProperty("code")){if(!configurationFile.code.hasOwnProperty(code_lang)){var keys=Object.keys(configurationFile.code);if(keys.length>0){if(code_lang!==""){console.warn("Translation file ("+json_url+") does not contain "+code_lang+" code, defaulting to "+keys[0])}code_lang=keys[0]}else{console.warn("Translation file ("+json_url+") does not contain any code");code_lang=""}}if(code_lang!==""){result.code=configurationFile.code[code_lang]}}var key,value;var query_string=JSAV.utils.getQueryParameter();if(configurationFile.hasOwnProperty("params")){for(key in configurationFile.params){if(configurationFile.params.hasOwnProperty(key)&&!query_string.hasOwnProperty(key)){value=configurationFile.params[key];setJSAVOpt(key,value);PARAMS[key]=value}}}},error:function(data){data=ODSA.UTILS.getJSON(data);if(data.hasOwnProperty("status")&&data.status===200){console.error("JSON language file is malformed. Please make sure your JSON is valid.")}else{console.error("Unable to load JSON language file ("+json_url+")")}}});function settingsSelector(type){return function(){var options={lang:{id:"jsavsettings-language",label:"language",param:"JOP-lang="},code_lang:{id:"jsavsettings-code",label:"programming",param:"JXOP-code="}};function getLabel(string){if(translations[string]){return translations[string].language_name}return string.charAt(0).toUpperCase()+string.slice(1)}var translations={en:{language_name:"English",language:"Language:",programming:"Programming language:"},fi:{language_name:"Suomi",language:"Kieli:",programming:"Ohjelmointikieli:"},sv:{language_name:"Svenska",language:"Språk:",programming:"Programmeringsspråk:"}};var opts=options[type]||options.lang,label=(translations[lang]?translations[lang]:translations.en)[opts.label],$elem=$('<div class="jsavrow">'+'<label for="'+opts.id+'">'+label+" </label>"+'<select id="'+opts.id+'"></select></div>'),$select=$elem.find("#"+opts.id),vals=type==="lang"?langs:code_langs,selected=type==="lang"?lang:code_lang,optElems="";vals.forEach(function(val){optElems+='<option value="'+val+'" '+(val===selected?"selected":"")+">"+getLabel(val)+"</option>"});$select.append(optElems);$select.change(function(){var url=window.location.href,regexp=new RegExp(opts.param+"[^&]*"),newParameter=opts.param+$select.val();if(url.search(regexp)!==-1){url=url.replace(regexp,newParameter)}else{var appendChar=url.search(/\?/)===-1?"?":"&";url+=appendChar+newParameter}window.location.href=url});return $elem}}result.getSettings=function(){var settings=new JSAV.utils.Settings($(".jsavsettings"));if(langs.length>1){settings.add(settingsSelector("lang"))}if(code_langs.length>1){settings.add(settingsSelector("code_lang"))}return settings};if(result.code){var url="";if(loggingServerEnabled()){if(Array.isArray(result.code)){for(var i=0;i<result.code.length;i++){url=result.code[i].url;result.code[i].url="/OpenDSA/"+url.slice(url.indexOf("SourceCode"))}}else{url=result.code.url;result.code.url="/OpenDSA/"+url.slice(url.indexOf("SourceCode"))}}}return result}function isValidEvent(data){if(typeof data.av==="undefined"){data.av=""}if(typeof data.uiid==="undefined"){data.uiid=uiid}var missingFields=[];if(typeof data.type==="undefined"){missingFields.push("type")}if(typeof data.desc==="undefined"){missingFields.push("desc")}if(missingFields.length>0){if(missingFields.length===1){console.warn("Invalid event, '"+missingFields[0]+"' is undefined")}else{console.warn("Invalid event, '"+missingFields.join(", ")+"' are undefined")}return false}return true}function logEvent(data){if(loggingServerEnabled()){data=getJSON(data);var reqAttrib=["av","desc","module_name","steps_fixed","tstamp","type","uiid"];for(var prop in data){if(data.hasOwnProperty(prop)&&reqAttrib.indexOf(prop)===-1){delete data.prop}}if(!isValidEvent(data)){console.warn("logEvent() error: Invalid event");console.log(data);return}if(data.av===""&&moduleName===""){console.warn('Exercise name and moduleName cannot both be ""');return}data.module=moduleName;if(odsaUtils.scoringServerEnabled()){data.user_email=getUserEmail();if(hasBook()){data.inst_book_id=getBookID();if(isFullModule()){data.inst_chapter_module_id=getChapterModuleID()}else{data.inst_section_id=getSectionID()}}else if(isStandaloneModule()){data.inst_module_version_id=getInstModuleVersionId()}else{data.inst_course_offering_exercise_id=getInstCourseOfferingExerciseId()}}if(data.tstamp){data.tstamp=new Date(data.tstamp).getTime()}else{data.tstamp=(new Date).getTime()}data.desc=JSON.stringify(data.desc);var rand=Math.floor(Math.random()*101);localStorage[["event",data.tstamp,rand].join("-")]=JSON.stringify(data)}}function logUserAction(type,desc,exerName,eventUiid){if(loggingServerEnabled()){var eventData={};eventData.type=type;eventData.desc=desc;eventData.av=exerName?exerName:settings.AV_NAME;eventData.uiid=eventUiid?eventUiid:uiid;logEvent(eventData)}}function sendEventData(){if(loggingServerEnabled()){var tstamp=(new Date).getTime(),keysToPurge=[],userInteractions={},eventObj;if(hasBook()){userInteractions["inst_book_id"]=getBookID()}userInteractions.eventList=[];for(var key in localStorage){if(key.indexOf("event-")===0&&parseInt(key.split("-")[1],10)<tstamp){eventObj=getJSON(localStorage[key]);if(eventObj.user_email==getUserEmail()&&eventObj.inst_book_id==getBookID()){keysToPurge.push(key);userInteractions.eventList.push(getJSON(localStorage[key]))}}}if(userInteractions.eventList.length===0){return true}jQuery.ajax({url:"/odsa_user_interactions",type:"POST",data:JSON.stringify(userInteractions),contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(data){data=getJSON(data);for(var i in keysToPurge){if(keysToPurge.hasOwnProperty(i)){localStorage.removeItem(keysToPurge[i])}}},error:function(data){data=getJSON(data);if(data.status===400){console.group("Event data rejected by server");console.debug(JSON.stringify(eventList));console.groupEnd();for(var i in keysToPurge){if(keysToPurge.hasOwnProperty(i)){localStorage.removeItem(keysToPurge[i])}}}else if(data.status===401){$("body").trigger("odsa-session-expired",[sessionKey])}else{console.group("Error sending event data");console.debug(data);console.groupEnd()}}})}}function aggregateTimeTrackingData(localforage){var currentDate=getIndexedDBKey(undefined,"yyyymmdd");var _keys=[];var modulesTracking={};var promise=new Promise((resolve,reject)=>{if(!localforage){reject("localforge is not loaded!")}localforage.keys().then(function(keys){keys.forEach(function(key,i){var keyDate=key.split("-")[2];if(parseInt(keyDate)<parseInt(currentDate)){_keys.push(key)}});_keys=_keys.slice(0,25);var promises=_keys.map(function(item){return localforage.getItem(item)});Promise.all(promises).then(sessions=>{sessions.forEach(function(session,i){try{var keyArray=session["key"].split("-");keyArray.pop();var sessionKey=keyArray.join("-");if(sessionKey in modulesTracking){var allTimes=session["allTimes"];allTimes.forEach(function(section,i){var sectionName=Object.keys(section)[0];modulesTracking[sessionKey]["allTimes"][i][sectionName]+=section[sectionName]})}else{modulesTracking[sessionKey]=session}}catch(err){console.log(err);reject(err)}});resolve({_keys:_keys,modulesTracking:modulesTracking})})}).catch(function(err){console.log(err);reject(err)})});return promise}function sendTimeTrackingData(timeTrackingData,localforage){if(!timeTrackingData||!localforage){return}var modulesTracking=timeTrackingData["modulesTracking"];var _keys=timeTrackingData["_keys"];if(jQuery.isEmptyObject(modulesTracking)||!Array.isArray(_keys)||!_keys.length){return}var promises=_keys.map(function(item){return localforage.removeItem(item)});Promise.all(promises).then(()=>{for(const property in modulesTracking){var allTimes=modulesTracking[property]["allTimes"];allTimes.map(function(item){var key=Object.keys(item)[0];var newItem={};newItem[key]=parseFloat(item[key].toFixed(2));return newItem});modulesTracking[property]["totalTime"]=Object.values(allTimes[0])[0];modulesTracking[property]["sectionsTime"]=JSON.stringify(allTimes);modulesTracking[property]["uuid"]=uuidv4();delete modulesTracking[property]["allTimes"]}var data={modulesTracking:modulesTracking};retryPostAPICall("/odsa_user_time_tracking",data)})}function retryPostAPICall(url,data,retries=5,backoff=1e3){const retryCodes=[408,429,500,502,503,504,522,524];var promise=new Promise((resolve,reject)=>{$.ajax({url:url,type:"POST",data:JSON.stringify(data),contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(data){resolve(data)},error:function(err){reject(err)}})});return promise.then(res=>{if(res.status==200){return res}if(retries>0&&retryCodes.includes(res.status)){setTimeout(()=>{return retryPostAPICall(url,data,retries-1,backoff*2)},backoff)}else{console.log("Failed to send data after "+(5-retries)+" retries. Status: "+res.status)}}).catch(err=>{if(retries>0&&retryCodes.includes(err.status)){setTimeout(()=>{return retryPostAPICall(url,data,retries-1,backoff*2)},backoff)}else{console.log("Failed to send data after "+(5-retries)+" retries. Status: "+err.status)}})}function buttonLogger(){if(loggingServerEnabled()){var type="",desc="";if(this.id!==""){type=this.type+"-"+this.id}else{type=this.type;console.warn(this.value+" button does not have an ID")}if(this.hasAttribute("data-desc")){desc=this.getAttribute("data-desc")}else if(this.value!==""){desc=this.value}else if(this.id!==""){desc=this.id}else if(this.name!==""){desc=this.name}logUserAction(type,desc)}}function linkLogger(){if(loggingServerEnabled()){var href=this.href;if(href.indexOf("#")!==-1){href=href.slice(href.indexOf("#"))}var type="",desc={href:href,text:$(this).html};if(settings.AV_NAME===""&&this.form){settings.AV_NAME=this.form.id}if(this.id!==""){type="hyperlink-"+this.id}else{type="hyperlink";console.warn("Link ("+this.href+") does not have an ID")}logUserAction(type,desc)}}function getIndexedDBKey(key,format){var key=key||"";var format=format||"yyyymmdd-HHMMSS";var d=new Date,year=d.getFullYear(),month=""+(d.getMonth()+1),day=""+d.getDate(),hours=""+d.getHours(),minutes=""+d.getMinutes(),seconds=""+d.getSeconds();if(month.length<2)month="0"+month;if(day.length<2)day="0"+day;if(hours.length<2)hours="0"+hours;if(minutes.length<2)minutes="0"+minutes;if(seconds.length<2)seconds="0"+seconds;var keyArray=key.split("-");var keyDate=key?keyArray[2]:"0";var currentDate=[year,month,day].join("");if(parseInt(keyDate)!=parseInt(currentDate)){if(format=="yyyymmdd"){return[year,month,day].join("")}else{return[year,month,day,"-",hours,minutes,seconds].join("")}}else{return[keyArray[2],keyArray[3]].join("-")}}function logTimeTrackingData(key,currentPageName,trackingPageNames,odsaStore){var key=key||"";var newKey=currentPageName+"-"+getIndexedDBKey(key);var logData={};logData["allTimes"]=TimeMe.getTimeOnAllElements("combactObjects",trackingPageNames);logData["key"]=key;logData["user_email"]=getUserEmail();if(hasBook()){logData["inst_book_id"]=getBookID();if(isFullModule()){logData["inst_module_id"]=getModuleID();logData["inst_chapter_id"]=getChapterID()}else{logData["inst_section_id"]=getSectionID()}}else if(isStandaloneModule()){logData["inst_module_version_id"]=getInstModuleVersionId()}else{logData["inst_course_offering_exercise_id"]=getInstCourseOfferingExerciseId()}odsaStore.setItem(key,logData);if(newKey!=key){TimeMe.resetAllRecordedPageTimes()}return newKey}function InitializeTimeMe(currentPageName,moduleSections,exerciseName){if(!window.TimeMe||!window.localforage||!loggingServerEnabled()||!getBookID()){return null}var currentPageName=currentPageName||"";if(!moduleSections){currentPageName=exerciseName.toLowerCase()}TimeMe.initialize({currentPageName:currentPageName,idleTimeoutInSeconds:30});var odsaStore="";if(moduleSections){moduleSections.forEach(function(section,i){TimeMe.trackTimeOnElement(section)});var storeName=`odsaTimeTrackingBookId_${getBookID()}`;odsaStore=localforage.createInstance({name:storeName,storeName:storeName});var trackingPageNames=[currentPageName].concat(moduleSections);var key=currentPageName+"-"+getIndexedDBKey(key);TimeMe.callWhenUserLeaves(function(){key=logTimeTrackingData(key,currentPageName,trackingPageNames,odsaStore)});TimeMe.callWhenUserReturns(function(){key=logTimeTrackingData(key,currentPageName,trackingPageNames,odsaStore)});setInterval(function(){key=logTimeTrackingData(key,currentPageName,trackingPageNames,odsaStore)},1e4)}return odsaStore}function getCurrentPageName(chapterName,moduleName){var chapterName=chapterName||"chapterName";var moduleName=moduleName||"moduleName";chapterName=chapterName.toLowerCase().replace(" ","_").replace("-","");moduleName=moduleName.toLowerCase().replace(" ","_").replace("-","");return chapterName+"-"+moduleName}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}if(!(window.console&&console.log)){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}if(typeof JSAV_EXERCISE_OPTIONS==="undefined"){window.JSAV_EXERCISE_OPTIONS={}}if(typeof window.JSAV_OPTIONS==="undefined"){window.JSAV_OPTIONS={}}JSAV_EXERCISE_OPTIONS.feedback="continuous";JSAV_EXERCISE_OPTIONS.fixmode="fix";parseURLParams();if(typeof ODSA==="undefined"){var odsaSettings={};odsaSettings.BOOK_ID=PARAMS.book;odsaSettings.EXERCISE_SERVER=PARAMS.exerciseServer;odsaSettings.LOGGING_SERVER=PARAMS.loggingServer;odsaSettings.SCORE_SERVER=PARAMS.scoreServer;odsaSettings.MODULE_ORIGIN=PARAMS.moduleOrigin;odsaSettings.MODULE_NAME=PARAMS.module;odsaSettings.NARRATION_ENABLED=PARAMS.narrationEnabled;if(!odsaSettings.MODULE_ORIGIN){odsaSettings.MODULE_ORIGIN=location.origin}window.ODSA={};window.ODSA.SETTINGS=odsaSettings}else{langDict=loadLangMod()}settings=ODSA.SETTINGS;settings.EXERCISE_ORIGIN=settings.MODULE_ORIGIN;settings.AV_ORIGIN=settings.MODULE_ORIGIN;settings.AV_NAME="";if(location.hostname==="127.0.0.1"||location.hostname==="localhost"){settings.MODULE_ORIGIN=settings.AV_ORIGIN=settings.EXERCISE_ORIGIN=location.origin}if(settings.NARRATION_ENABLED===false){JSAV_OPTIONS.narration.enabled=false}else{JSAV_OPTIONS.narration.enabled=true}$(document).ready(function(){settings.MODULE_NAME=settings.hasOwnProperty("MODULE_NAME")?settings.MODULE_NAME:"";settings.MODULE_CHAPTER=settings.hasOwnProperty("MODULE_CHAPTER")?settings.MODULE_CHAPTER:"";settings.MODULE_SECTIONS=settings.hasOwnProperty("MODULE_SECTIONS")?settings.MODULE_SECTIONS:"";moduleName=settings.MODULE_NAME;chapterName=settings.MODULE_CHAPTER;moduleSections=settings.MODULE_SECTIONS;exerciseName=settings.AV_NAME;var a="to:opendsa";var b="cs.vt.edu";var c="%40";var d="mail";$("#contact_us").attr("href",d+a+c+b).on("click",function(){window.top.location=$(this).prop("href");return false});var localStorageEnabled=function(){var enabled,uid=+new Date;try{localStorage[uid]=uid;enabled=localStorage[uid]===uid;localStorage.removeItem(uid);return enabled}catch(e){return false}};if(!localStorageEnabled){if(jQuery){warn("You must enable DOM storage in your browser.",false)}return}$(":button").each(function(index,item){if(!isJSAVControl(item)){$(item).click(buttonLogger)}});$("a").each(function(index,item){if(!isJSAVControl(item)&&$(item).attr("id")!=="logon"&&$(item).attr("class")!=="close"){$(item).click(linkLogger)}});var currentPageName=getCurrentPageName(chapterName,moduleName);var odsaStore=InitializeTimeMe(currentPageName,moduleSections,exerciseName);if(moduleSections){if(loggingServerEnabled()){aggregateTimeTrackingData(odsaStore).then(TimeTracking=>{sendTimeTrackingData(TimeTracking,odsaStore)}).catch(err=>{console.log(err)})}}});var getGlossaryInfoSuccess;var canvasGlossaryPageLink;var glossaryParaminitialized=false;function initGlossaryParam(){getGlossaryInfoSuccess=true;glossaryParaminitialized=true;if(ODSA.TP){try{var json_url=$('script[src*="/config.js"]')[0].src.replace("html/_static/config.js","lti_html/lti_config.json")}catch(err){getGlossaryInfoSuccess=false}var json_data;if(getGlossaryInfoSuccess){$.ajax({url:json_url,dataType:"json",async:false,success:function(data){json_data=data},error:function(){getGlossaryInfoSuccess=false}})}var canvasUrl="";if(ODSA.TP.toParams&&ODSA.TP.toParams.launch_params&&ODSA.TP.toParams.launch_params.custom_canvas_api_base_url){canvasUrl=ODSA.TP.toParams.launch_params.custom_canvas_api_base_url}else{getGlossaryInfoSuccess=false}if(getGlossaryInfoSuccess&&json_data){var canvasID=ODSA.TP.toParams.launch_params.custom_canvas_course_id;if(!json_data["module_map"]["Glossary"]){getGlossaryInfoSuccess=false}else{var glossaryPageID=json_data["module_map"]["Glossary"]["module_item_id"];canvasGlossaryPageLink=canvasUrl+"/courses/"+canvasID+"/modules/items/"+glossaryPageID}}else{getGlossaryInfoSuccess=false}}else if(ODSA.MOD){try{$.ajax({url:"./Glossary.html",async:false,error:function(){console.log("You need to include a glossary module to enable glossaries support!");getGlossaryInfoSuccess=false}})}catch(err){getGlossaryInfoSuccess=false}}else{getGlossaryInfoSuccess=false}}function parseGlossaries(msg){var parsedMsg=msg;var glossaries=[...msg.matchAll(/:term:`(.*?)`/g)];if(glossaries.length!==0&&!glossaryParaminitialized){initGlossaryParam()}for(var i=0;i<glossaries.length;i++){var parsedGlossary=glossaries[i][1].match(/\<([^>]+)\>/);var refGlossary="";var displayGlossary="";if(parsedGlossary){refGlossary=parsedGlossary[1];displayGlossary=glossaries[i][1].slice(0,parsedGlossary.index-1)}else{refGlossary=glossaries[i][1];displayGlossary=glossaries[i][1]}if(!getGlossaryInfoSuccess){parsedMsg=parsedMsg.replace(glossaries[i][0],"<b>"+displayGlossary+"</b>")}if(!ODSA.TP){parsedMsg=parsedMsg.replace(glossaries[i][0],'<a class="reference internal" href="Glossary.html#term-'+refGlossary.replace(/ /g,"-")+'" target="_blank"><em class="xref std std-term">'+displayGlossary+"</em></a>")}else{parsedMsg=parsedMsg.replace(glossaries[i][0],'<a class="reference internal" href="'+canvasGlossaryPageLink+"#term-"+refGlossary.replace(/ /g,"-")+'" target="_blank"><em class="xref std std-term">'+displayGlossary+"</em></a>")}}return parsedMsg}JSAV.prototype.constructor.ext.umsg=function(msg,options){this._msg.umsg(parseGlossaries(msg),options)};var odsaUtils={};odsaUtils.params=PARAMS;odsaUtils.langDict=langDict;odsaUtils.hasToolProvider=hasToolProvider;odsaUtils.hasBook=hasBook;odsaUtils.isFullModule=isFullModule;odsaUtils.isStandaloneModule=isStandaloneModule;odsaUtils.getBookID=getBookID;odsaUtils.getSectionID=getSectionID;odsaUtils.getChapterModuleID=getChapterModuleID;odsaUtils.getModuleID=getModuleID;odsaUtils.getInstModuleVersionId=getInstModuleVersionId;odsaUtils.getExerciseSettings=getExerciseSettings;odsaUtils.getInstCourseOfferingExerciseId=getInstCourseOfferingExerciseId;odsaUtils.getBookURL=getBookURL;odsaUtils.getUserEmail=getUserEmail;odsaUtils.loggingServerEnabled=loggingServerEnabled;odsaUtils.scoringServerEnabled=scoringServerEnabled;odsaUtils.getJSON=getJSON;odsaUtils.permute=permute;odsaUtils.handleMsg=handleMsg;odsaUtils.loadConfig=loadConfig;odsaUtils.logUserAction=logUserAction;odsaUtils.logEvent=logEvent;odsaUtils.sendEventData=sendEventData;odsaUtils.roundPercent=roundPercent;odsaUtils.getType=getType;odsaUtils.parseURLParams=parseURLParams;odsaUtils.discardEvents=["jsav-init","jsav-recorded","jsav-exercise-init","jsav-exercise-model-init","jsav-exercise-model-recorded"];odsaUtils.ssEvents=["jsav-forward","jsav-backward","jsav-begin","jsav-end","jsav-exercise-model-forward","jsav-exercise-model-backward","jsav-exercise-model-begin","jsav-exercise-model-end","jsav-narration-on","jsav-narration-off"];odsaUtils.parseGlossaries=parseGlossaries;window.ODSA.UTILS=odsaUtils})(jQuery);
